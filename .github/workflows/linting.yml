name: Linting
on:
  push:
    branches: [ main ]
  pull_request:
    branches: [ main ]
  workflow_dispatch:

jobs:
    linting:
        runs-on: ubuntu-latest
        strategy:
            matrix:
                files: [
                    "AdditionalHardening.admx", 
                    "AdditionalDebugPolicies.admx", 
                    "AdditionalDefenderPolicies.admx", 
                    "AdditionalHardeningFromMicrosoft.admx", 
                    "AdditionalLegacyHardening.admx", 
                    "AdditionalNetworkHardening.admx", 
                    "AdditionalSystemHardening.admx"
                    ]
        container:
            image: fstossesds/admx-lint
        steps:
            - 
                name: Checkout
                uses: actions/checkout@v4.2.2
            - 
                name: Lint ADMX files
                run: admx-lint --input_file ${{ matrix.files }}
    
    linting-script:
        runs-on: ubuntu-latest
        steps:
            - 
                name: Checkout code
                uses: actions/checkout@v4.2.2

            - 
                name: Invoke PSScriptAnalyzer
                uses: PSModule/Invoke-ScriptAnalyzer@v3.0.0
                with:
                    Settings: Custom
                    Output_CIFormat: GithubActions
                    CodeCoverage_Enabled: false
    